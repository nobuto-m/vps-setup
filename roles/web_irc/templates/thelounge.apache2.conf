<VirtualHost *:80>
    ServerName {{ web_irc_fqdn }}
</VirtualHost>

<VirtualHost *:433>
    ServerName {{ web_irc_fqdn }}

    SSLCertificateFile /etc/letsencrypt/live/{{ web_irc_fqdn }}/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/{{ web_irc_fqdn }}/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf

    # https://thelounge.chat/docs/guides/reverse-proxies#apache
    RewriteEngine On
    RewriteCond %{REQUEST_URI}  ^/socket.io            [NC]
    RewriteCond %{QUERY_STRING} transport=websocket    [NC]
    RewriteRule /(.*)           ws://127.0.0.1:9000/$1 [P,L]

    ProxyVia On
    ProxyRequests Off
    ProxyAddHeaders On
    ProxyPass / http://127.0.0.1:9000/
    ProxyPassReverse / http://127.0.0.1:9000/

    # By default Apache times out connections after one minute
    ProxyTimeout 86400
</VirtualHost>
